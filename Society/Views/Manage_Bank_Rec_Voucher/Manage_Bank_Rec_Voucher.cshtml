@model dynamic
@using Society.Data
@{
    ViewBag.Title = "Manage_Bank_Rec_Voucher";
}
@if (Session["CNIC"] == null || Session["type"].ToString() == "Employee" || ViewBag.Key==false) { Response.Redirect("/Login/Login"); }
else
{
<div class="content-wrapper" id="load">
    <section class="content-header">
        <div class="container-fluid">
            <div class="row mb-2">
                <div class="col-sm-6">
                    <h1>Bank Reciept Vouchers</h1>
                </div>
                <div class="col-sm-6">
                    <ol class="breadcrumb float-sm-right">
                        <li class="breadcrumb-item"><a href="#">Home</a></li>
                        <li class="breadcrumb-item active">Vouchers</li>
                    </ol>
                </div>
            </div>
        </div>
    </section><div class="col-3 form-group offset-4"> <input type="search" id="srch" class="form-control has-Search" onkeyup="cc()" placeholder="Search" /></div>
              <script>
                  function cc() {

                      var v = $('#srch').val();

                      $.ajax({
                          url: '/Manage_Bank_Rec_Voucher/result',
                          type: 'POST',
                          data: {
                              search1: v

                          },
                          success: function (data) {


                              var table = $('#example1').DataTable();
                              table.clear();
                              var table1 = $('#example3').DataTable();
                              table1.clear();

                              var obj = JSON.parse(data);
                              var tr;

                              //Append each row to html table
                              for (var i = 0; i < obj.length; i++) {
                                  tr = $('<tr/>');
                                  tr.append("<td>" + obj[i].RV_ID + "</td>");
                                  tr.append("<td>" + obj[i].VoucherNum + "</td>");



                                  var today = new Date(obj[i].VoucherDate);
                                  var dd = today.getDate();

                                  var mm = today.getMonth() + 1;
                                  var yyyy = today.getFullYear();
                                  if (dd < 10) {
                                      dd = '0' + dd;
                                  }

                                  if (mm < 10) {
                                      mm = '0' + mm;
                                  }
                                  today = yyyy + '-' + mm + '-' + dd;

                                  tr.append("<td>" + today + "</td>");
                                  tr.append("<td>" + obj[i].ChequeNumber + "</td>");
                                  var today1 = new Date(obj[i].ChequeDate);
                                  var dd1 = today1.getDate();

                                  var mm1 = today1.getMonth() + 1;
                                  var yyyy1 = today1.getFullYear();
                                  if (dd1 < 10) {
                                      dd1 = '0' + dd;
                                  }

                                  if (mm1 < 10) {
                                      mm1 = '0' + mm1;
                                  }
                                  today1 = yyyy1 + '-' + mm1 + '-' + dd1;

                                  tr.append("<td>" + today1 + "</td>");

                                  tr.append("<td>" + obj[i].Drown_bank + "</td>");

                                  tr.append("<td>" + obj[i].Manual_Voucher_No + "</td>");
                                  tr.append("<td>" + obj[i].Comments + "</td>");
                                 var amont= (obj[i].Amount).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                                  tr.append("<td>Rs" + amont + "</td>");


                                  if (obj[i].IsApproved == 0) {
                                      tr.append("<td>" + ` <a class="btn btn-secondary btn-sm m-1" title="Preview" target="_blank" href="/Manage_Bank_Rec_Voucher/voucherpreview?VoucherNum=` + obj[i].VoucherNum + `"><i class="fas fa-eye"></i> </a>
                                                                                    <a class="btn btn-success btn-sm m-1" title="Approve" href="javascript:markVoucherApproved('` + obj[i].VoucherNum + `','C')"><i class="fas fa-user"></i> </a>
                                                                                    <a class="btn btn-danger btn-sm m-1" title="Delete" href="javascript:deletevoucher('` + obj[i].VoucherNum + `')"><i class="fas fa-trash"></i> </a>`

                                                                                    + "</td>");

                                      table.row.add(tr);

                                      table.draw();
                                     
                                  } else if (obj[i].IsApproved == 1) {
                                      /**/
                                      tr.append("<td>" + `   <a class="btn btn-secondary btn-sm m-1" title="Preview" target="_blank" href="/Manage_Bank_Rec_Voucher/voucherpreview?VoucherNum=` + obj[i].VoucherNum + `"><i class="fas fa-eye"></i> </a>` + "</td>");
                  /**/

                  table1.row.add(tr);

                  table1.draw();
                  
              }



          }
      }


  });
}


              </script>
    <section class="content">
        <div class="row">
            <div class="col-12 col-sm-12 col-md-12 col-lg-12">
                <div class="card card-primary card-tabs">
                    <div class="card-header p-0 pt-1">
                        <ul class="nav nav-tabs" id="custom-tabs-two-tab" role="tablist">
                            <li class="pt-2 px-3">
                                <h3 class="card-title">Bank Reciept Vouchers</h3>
                            </li>

                            <li class="nav-item">
                                <a class="nav-link active" id="custom-tabs-two-home-tab" data-toggle="pill"
                                   href="#custom-tabs-two-home" role="tab" aria-controls="custom-tabs-two-home"
                                   aria-selected="true">Pending</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="custom-tabs-two-messages-tab" data-toggle="pill"
                                   href="#custom-tabs-two-messages" role="tab" aria-controls="custom-tabs-two-messages"
                                   aria-selected="false">Approved</a>
                            </li>

                            <li class="nav-item">
                                <a href="/Manage_Bank_Rec_Voucher/Add_Bank_Rec_Voucher?t=BRV" class="btn btn-success"> Add New</a>
                            </li>

                        </ul>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="custom-tabs-two-tabContent">
                            <div class="tab-pane fade show active" id="custom-tabs-two-home" role="tabpanel"
                                 aria-labelledby="custom-tabs-two-home-tab">
                                <table class="table table-striped projects" id="example1">
                                    <thead>
                                        <tr>
                                            <th style="width: 1%">#</th>
                                            <th style="width: 5%">Voucher#</th>
                                            <th style="width: 8%">Voucher Date</th>
                                            <th style="width: 9%">Cheque Number</th>
                                            <th style="width: 9%">Cheque Date</th>
                                            <th style="width: 9%">Drown Bank</th>
                                            <th style="width: 15%">Manual Voucher No</th>
                                            <th style="width: 15%">Particulars</th>
                                            <th style="width: 15%">Amount</th>
                                            <th style="width: 20%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        @foreach (reciept_vouchers x in Model.Pending_Amount)
                                        {
                                            if (x.IsApproved == 0)
                                            {
                                                <tr>
                                                    <td>@x.RV_ID</td>
                                                    <td>@x.VoucherNum</td>
                                                    <td>@x.VoucherDate.ToString("dd-MM-yyyy")</td>
                                                    <td>@x.ChequeNumber</td>
                                                    @{ DateTime d = (DateTime)x.ChequeDate;}
                                                <td>@d.ToString("dd-MM-yyyy")</td>
                                                    <td>@x.Drown_bank</td>
                                                    <td>@x.Manual_Voucher_No</td>
                                                    <td>@x.Comments</td>
                                                    @{var a = x.reciept_voucher_payment.FirstOrDefault(k => k.RV_ID == x.RV_ID).Amount;

                                               
                                                    }
                                                    <td>Rs @a.ToString("n2") </td>
                                                    <td class="project-actions text-right">
                                                        <a class="btn btn-secondary btn-sm m-1" title="Preview" target="_blank" href="/Manage_Bank_Rec_Voucher/voucherpreview?VoucherNum=@x.VoucherNum"><i class="fas fa-eye"></i> </a>
                                                        <a class="btn btn-success btn-sm m-1" title="Approve" href="javascript:markVoucherApproved('@x.VoucherNum','C')"><i class="fas fa-user"></i> </a>
                                                        <a class="btn btn-danger btn-sm m-1" title="Delete" href="javascript:deletevoucher('@x.VoucherNum')"><i class="fas fa-trash"></i> </a>
                                                       
                                                    </td>
                                                </tr>
                                            }

                                        }
                                    </tbody>
                                </table>
                            </div>

                            <div class="tab-pane fade" id="custom-tabs-two-messages" role="tabpanel"
                                 aria-labelledby="custom-tabs-two-messages-tab">
                                <table class="table table-striped projects" id="example3">
                                    <thead>
                                        <tr>
                                            <th style="width: 1%">#</th>
                                            <th style="width: 5%">Voucher#</th>
                                            <th style="width: 8%">Voucher Date</th>
                                            <th style="width: 9%">Cheque Number</th>
                                            <th style="width: 9%">Cheque Date</th>
                                            <th style="width: 9%">Drown Bank</th>
                                            <th style="width: 15%">Manual Voucher No</th>
                                            <th style="width: 15%">Particulars</th>
                                            <th style="width: 15%">Amount</th>
                                            <th style="width: 20%">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (reciept_vouchers x in Model.Pending_Amount)
                                        {
                                            if (x.IsApproved == 1)
                                            {
                                        <tr>
                                            <td>@x.RV_ID</td>
                                            <td>@x.VoucherNum</td>
                                            <td>@x.VoucherDate.ToString("dd-MM-yyyy")</td>
                                            <td>@x.ChequeNumber</td>
                                            @{ DateTime d1 = (DateTime)x.ChequeDate;}
                                            <td>@d1.ToString("dd-MM-yyyy")</td>
                                         
                                            <td>@x.Drown_bank</td>
                                            <td>@x.Manual_Voucher_No</td>
                                            <td>@x.Comments</td>
                                            @{var a = x.reciept_voucher_payment.FirstOrDefault(k => k.RV_ID == x.RV_ID).Amount;


                                            }
                                        <td>Rs @a.ToString("n2")  </td>
                                            <td class="project-actions text-right">
                                                <a class="btn btn-secondary btn-sm m-1" title="Preview" target="_blank" href="/Manage_Bank_Rec_Voucher/voucherpreview?VoucherNum=@x.VoucherNum"><i class="fas fa-eye"></i> </a>



                                            </td>
                                        </tr>
                                            }

                                        }

                                    </tbody>
                                </table>
                            </div>

                            <script>
                                function updatevoucher(id) {



                                }
                                function deletevoucher(id) {


                                    var msg = "Are you sure you want to delete this voucher?";



                                    var res = confirm(msg);
                                    if (res) {
                                        $.ajax({
                                            url: "/Manage_Bank_Rec_Voucher/deleteVoucher",
                                            type: "POST",
                                            data: {
                                                ID: id

                                            },
                                            cache: false,
                                            success: function (data) {
                                                //  dataResult = JSON.parse(dataResult);
                                                if (data == 200) {



                                                    alert("Voucher has been deleted.");



                                                    window.location.href = "/Manage_Bank_Rec_Voucher/Manage_Bank_Rec_Voucher";

                                                } else {
                                                    $.alert('Something went wrong.');
                                                }
                                            }
                                        });
                                    }
                                }

                                function markVoucherChecked(id, c) {
                                    var msg = "";
                                    if (c === 'C') {
                                        msg = "Are you sure you want to mark this voucher checked?";
                                    } else {
                                        msg = "Are you sure you want to mark this voucher un-checked?";
                                    }
                                    var res = confirm(msg);
                                    if (res) {
                                        $.ajax({
                                            url: "/Manage_Bank_Rec_Voucher/checkVoucher",
                                            type: "POST",
                                            data: {
                                                ID: id,
                                                Type: c
                                            },
                                            cache: false,
                                            success: function (data) {
                                                //  dataResult = JSON.parse(dataResult);
                                                if (data == 200) {
                                                    if (c === 'C') {
                                                        msg = "Voucher marked as Checked Successfully.";
                                                    } else {
                                                        msg = "Voucher marked as Un-Checked Successfully.";
                                                    }
                                                    alert(msg);



                                                    window.location.href = "/Manage_Bank_Rec_Voucher/Manage_Bank_Rec_Voucher";

                                                } else {
                                                    $.alert('Something went wrong.');
                                                }
                                            }
                                        });
                                    }
                                }

                                function markVoucherApproved(id, c) {
                                    var msg = "";
                                    if (c === 'C') {
                                        msg = "Are you sure you want to mark this voucher approved?";
                                    } else {
                                        msg = "Are you sure you want to mark this voucher un-approved?";
                                    }
                                    var res = confirm(msg);
                                    if (res) {
                                        $.ajax({
                                            url: "/Manage_Bank_Rec_Voucher/approvedVoucher",
                                            type: "POST",
                                            data: {
                                                ID: id,
                                                type: c
                                            },
                                            cache: false,
                                            success: function (data) {
                                              
                                                if (data == "true") {
                                                    alert('Voucher Added Successfully.');
                                                    window.location.href = "/Manage_Bank_Rec_Voucher/Manage_Bank_Rec_Voucher";


                                                } else {
                                                    if (c === 'C') {
                                                        msg = "Voucher marked as Approved Successfully.";
                                                    } else {
                                                        msg = "Voucher marked as Un-Approved Successfully.";
                                                    }
                                                    alert(msg);
                                                    window.location.href = "/Party/Print?id=" + data + "";
                                                }
                                                   
                                                
                                            }
                                        });
                                    }
                                }
                            </script>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
}


