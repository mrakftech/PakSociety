@model dynamic
@using Society.Data;

@{
    ViewBag.Title = "Add_Element_Account";
}
@if (Session["CNIC"] == null || Session["type"].ToString() == "Employee" || ViewBag.Key==false) { Response.Redirect("/Login/Login"); }
else
{
    <div class="content-wrapper">
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>Account Element</h1>
                    </div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-right">
                            <li class="breadcrumb-item"><a href="index.php">Home</a></li>
                            <li class="breadcrumb-item active">Accounts</li>
                        </ol>
                    </div>
                </div>
            </div>
        </section>

        <section class="content">


            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Add New Account Element</h3>
                </div>

                <div class="card-body">
                    <label class="float-left col-2 m-1">Account Element Code:</label>



                    <input type="number" placeholder="Account Code" name="txtAccountCode" id="txtAccountCode" value="@(Model.Max_Code + 1)"
                           class="form-control col-3 float-left" readonly />

                    <label class=" float-left col-2 m-1">Account Element Title:</label>
                    <input type="text" placeholder="Account Title" name="txtAccountTitle" id="txtAccountTitle"
                           class="form-control col-3 float-left" required />
                    <button class="float-left m-1 btn btn-primary" id="btnSave" onclick="Add_Account()" name="btnSave">Add Now</button>




                </div>

            </div>


            <div class="card">
                <div class="card-header">
                    <h3 class="card-title">Element Account</h3>
                </div>
                <div class="card-body p-0">
                    <table class="table table-striped projects" id="tb" name="tb">
                        <thead>
                            <tr>
                                <th style="width: 1%">#</th>
                                <th style="width: 20%">Account Element Code</th>
                                <th style="width: 59%">Account Element Title</th>
                                <th style="width: 20%">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (Element_Account x in Model.Element_List)
                            {
                                <tr>
                                    <td>@x.ID</td>
                                    <td>@x.Element_Account_Code</td>
                                    <td>@x.Account_Title</td>
                                    <td> <a href="javascript:addNewRole('@x.Account_Title','@x.ID')" class="btn btn-primary"><i class="fas fa-pencil-alt"></i></a></td>
                                </tr>
                            }
                        </tbody>
                    </table>


                </div>
            </div>
        </section>
        <script>
            function addNewRole(val,id) {
                var role = prompt("Enter New Account Title", val );
                var id = id;
                role = $.trim(role);
                if (role == "") {
                    alert("Enter valid Account title.");
                } else {
                    $.ajax({
                        url: "/Element_Account/Update_Element_Account",
                        type: "POST",
                        data: {
                            title: role,
                            id:id
                        },
                        cache: false,
                        success: function (data) {

                            if (data == true) {
                                alert('title Updated Successfully.');
                                window.location.href = "/Element_Account/Add_Element_Account";
                            }  else { $.alert('Something went wrong.'); }
                        }
                    });
                }
            }
            function Add_Account() {
                var accountcode = $('#txtAccountCode').val();
                var accounttitle = $('#txtAccountTitle').val();

                if (accounttitle == "") {
                    alert("enter account title");
                } else {
                    $.ajax({
                        url: '/Element_Account/Add_Element_Account_Json',
                        type: 'POST',
                        data: {
                            accountcode: accountcode,
                            accounttitle: accounttitle


                        },
                        cache: false,
                        success: function (data) {



                            var obj = JSON.parse(data);

                            var count = 1;
                            var tr;
                            $('#tb').find('tbody').empty();

                            //Append each row to html table
                            for (var i = 0; i < obj.length; i++) {
                                tr = $('<tr>');
                                tr.append("<td>" + obj[i].ID + "</td>");
                                tr.append("<td>" + obj[i].Element_Account_Code + "</td>");
                                tr.append("<td>" + obj[i].Account_Title + "</td>");

                                $('#tb').append(tr);
                                count = count + 1;



                            }
                            $('#txtAccountCode').val(count);
                            $('#txtAccountTitle').val("");
                        }



                    });

                }
            }
        </script>
    </div>
}

